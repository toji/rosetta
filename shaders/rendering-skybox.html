
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base target="_parent">

    <title>Skybox</title>

    <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
    <link rel="stylesheet" href="../assets/shader.css"/>
  </head>
  <body>
    <div class='tabbed-content'>
      <ul class='tabs'>
        
        <li class='tab'>
          
          <input type='radio' id='wgsl' name='shader-tabs' checked>
          
          <label for='wgsl'>wgsl</label>
          <div class='content wgsl'>
            <pre class="language-wgsl"><code class="language-wgsl"><span class="token comment">//-----------------------</span><br><span class="token comment">// Skybox</span><br><span class="token comment">//-----------------------</span><br><br><span class="token comment">// This shader renders a cubemap skybox that's infinitely far away in the</span><br><span class="token comment">// background. It achieves the effect by dropping any translation and forcing</span><br><span class="token comment">// the geometry depth to the far plane. When combined with a depth func of</span><br><span class="token comment">// "less-equal" this causes the skybox to write to any depth fragment that has</span><br><span class="token comment">// not been written to yet. This ensures that there will be no clipping against</span><br><span class="token comment">// other geometry and, if the skybox is rendered last, prevents any overdraw.</span><br><br><span class="token comment">// Shader is intended to be called with a vertex buffer containing a cube that</span><br><span class="token comment">// extends from [-1, -1, -1] to [1, 1, 1].</span><br><br><span class="token keyword">struct</span> <span class="token class-name">Camera</span> <span class="token punctuation">{</span><br>  projection <span class="token punctuation">:</span> mat4x4f<span class="token punctuation">,</span><br>  view <span class="token punctuation">:</span> mat4x4f<br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token keyword">var</span><span class="token punctuation">&lt;</span><span class="token keyword">uniform</span><span class="token punctuation">></span> camera <span class="token punctuation">:</span> <span class="token class-name">Camera</span><span class="token punctuation">;</span><br><br><span class="token keyword">struct</span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span><br>  <span class="token punctuation">@</span><span class="token builtin-attribute"><span class="token attribute attr-name">builtin</span><span class="token punctuation">(</span><span class="token built-in-values attr-value">position</span><span class="token punctuation">)</span></span> position <span class="token punctuation">:</span> vec4f<span class="token punctuation">,</span><br>  <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> texcoord <span class="token punctuation">:</span> vec3f<span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token punctuation">@</span><span class="token attributes attr-name">vertex</span><br><span class="token keyword">fn</span> <span class="token functions function">vertexMain</span><span class="token punctuation">(</span><span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> position <span class="token punctuation">:</span> vec4f<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name">VertexOutput</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> output <span class="token punctuation">:</span> <span class="token class-name">VertexOutput</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Assuming that the geometry is a unit cube and we're using a cubemap, the</span><br>  <span class="token comment">// texture coordinates are just the vertex positions.</span><br>  output<span class="token punctuation">.</span>texCoord <span class="token operator">=</span> position<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span><br><br>  <span class="token keyword">var</span> modelView <span class="token operator">=</span> camera<span class="token punctuation">.</span>view<span class="token punctuation">;</span><br>  <span class="token comment">// Drop the translation portion of the modelView matrix</span><br>  modelView<span class="token punctuation">[</span><span class="token int-literal number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function-calls function">vec4f</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">,</span> <span class="token int-literal number">0</span><span class="token punctuation">,</span> <span class="token int-literal number">0</span><span class="token punctuation">,</span> modelView<span class="token punctuation">[</span><span class="token int-literal number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  output<span class="token punctuation">.</span>position <span class="token operator">=</span> camera<span class="token punctuation">.</span>projection <span class="token operator">*</span> modelView <span class="token operator">*</span> position<span class="token punctuation">;</span><br><br>  <span class="token comment">// Returning the W component for both Z and W forces the geometry depth to</span><br>  <span class="token comment">// the far plane.</span><br>  output<span class="token punctuation">.</span>position <span class="token operator">=</span> output<span class="token punctuation">.</span>position<span class="token punctuation">.</span>xyww<span class="token punctuation">;</span><br><br>  <span class="token keyword">return</span> output<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> <span class="token keyword">var</span> skyboxSampler <span class="token punctuation">:</span> <span class="token builtin">sampler</span><span class="token punctuation">;</span><br><span class="token punctuation">@</span><span class="token attributes attr-name">group</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token punctuation">@</span><span class="token attributes attr-name">binding</span><span class="token punctuation">(</span><span class="token int-literal number">1</span><span class="token punctuation">)</span> <span class="token keyword">var</span> skyboxTexture <span class="token punctuation">:</span> <span class="token builtin">texture_cube</span><span class="token punctuation">&lt;</span><span class="token builtin">f32</span><span class="token punctuation">></span><span class="token punctuation">;</span><br><br><span class="token punctuation">@</span><span class="token attributes attr-name">fragment</span><br><span class="token keyword">fn</span> <span class="token functions function">fragmentMain</span><span class="token punctuation">(</span><span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> texCoord <span class="token punctuation">:</span> vec3f<span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">@</span><span class="token attributes attr-name">location</span><span class="token punctuation">(</span><span class="token int-literal number">0</span><span class="token punctuation">)</span> vec4f <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token builtin">textureSample</span><span class="token punctuation">(</span>skyboxTexture<span class="token punctuation">,</span> skyboxSampler<span class="token punctuation">,</span> texCoord<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
          </div>
        </li>
        
        <li class='tab'>
          
          <input type='radio' id='es3.glsl' name='shader-tabs'>
          
          <label for='es3.glsl'>es3.glsl</label>
          <div class='content es3.glsl'>
            <pre class="language-glsl"><code class="language-glsl"><span class="token comment">//-----------------------</span><br><span class="token comment">// Skybox</span><br><span class="token comment">//-----------------------</span><br><br><span class="token comment">// This shader renders a cubemap skybox that's infinitely far away in the</span><br><span class="token comment">// background. It achieves the effect by dropping any translation and forcing</span><br><span class="token comment">// the geometry depth to the far plane. When combined with a depth func of</span><br><span class="token comment">// "less-equal" this causes the skybox to write to any depth fragment that has</span><br><span class="token comment">// not been written to yet. This ensures that there will be no clipping against</span><br><span class="token comment">// other geometry and, if the skybox is rendered last, prevents any overdraw.</span><br><br><span class="token comment">// Shader is intended to be called with a vertex buffer containing a cube that</span><br><span class="token comment">// extends from [-1, -1, -1] to [1, 1, 1].</span><br><br><span class="token comment"><h4>Vertex Shader</h4></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">300</span> es</span></span><br><br><span class="token keyword">layout</span><span class="token punctuation">(</span>std140<span class="token punctuation">)</span> <span class="token keyword">uniform</span> Camera <span class="token punctuation">{</span><br>  <span class="token keyword">mat4</span> projection<span class="token punctuation">;</span><br>  <span class="token keyword">mat4</span> view<span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token keyword">uniform</span> <span class="token keyword">mat4</span> model<span class="token punctuation">;</span><br><br><span class="token keyword">layout</span><span class="token punctuation">(</span>location <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token keyword">vec4</span> position<span class="token punctuation">;</span><br><br><span class="token keyword">out</span> <span class="token keyword">vec3</span> varTexcoord<span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Assuming that the geometry is a unit cube and we're using a cubemap, the</span><br>  <span class="token comment">// texture coordinates are just the vertex positions.</span><br>  varTexcoord <span class="token operator">=</span> position<span class="token punctuation">.</span>xyz<span class="token punctuation">;</span><br><br>  <span class="token keyword">mat4</span> modelView <span class="token operator">=</span> view<span class="token punctuation">;</span><br>  <span class="token comment">// Drop the translation portion of the modelView matrix</span><br>  modelView<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> modelView<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  gl_Position <span class="token operator">=</span> projection <span class="token operator">*</span> modelView <span class="token operator">*</span> worldPosition<span class="token punctuation">;</span><br><br>  <span class="token comment">// Returning the W component for both Z and W forces the geometry depth to</span><br>  <span class="token comment">// the far plane.</span><br>  gl_Position <span class="token operator">=</span> gl_Position<span class="token punctuation">.</span>xyww<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token comment"><h4>Fragment Shader</h4></span><br><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">300</span> es</span></span><br><span class="token keyword">precision</span> <span class="token keyword">highp</span> <span class="token keyword">float</span><span class="token punctuation">;</span><br><br><span class="token keyword">uniform</span> <span class="token keyword">samplerCube</span> skyboxTexture<span class="token punctuation">;</span><br><br><span class="token keyword">in</span> <span class="token keyword">vec3</span> varTexcoord<span class="token punctuation">;</span><br><span class="token keyword">out</span> <span class="token keyword">vec4</span> outputColor<span class="token punctuation">;</span><br><br><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  outputColor <span class="token operator">=</span> <span class="token function">texture</span><span class="token punctuation">(</span>skyboxTexture<span class="token punctuation">,</span> varTexcoord<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
          </div>
        </li>
        
      </ul>
    </div>

    <script type='module' src='../assets/shader.js'></script>
  </body>
</html>